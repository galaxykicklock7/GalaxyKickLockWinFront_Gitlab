<!DOCTYPE html>
<html>
<head>
    <title>Debug UI to Backend Connection</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #00ff00; }
        button { background: #00ff00; color: #000; padding: 10px 20px; margin: 5px; cursor: pointer; border: none; }
        button:hover { background: #00cc00; }
        pre { background: #000; padding: 10px; overflow-x: auto; }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
        .warning { color: #ffaa00; }
    </style>
</head>
<body>
    <h1>üîç Debug UI to Backend Connection</h1>
    
    <div class="section">
        <h2>Step 1: Check localStorage</h2>
        <button onclick="checkLocalStorage()">Check localStorage</button>
        <pre id="localStorage-result"></pre>
    </div>

    <div class="section">
        <h2>Step 2: Fix Backend URL</h2>
        <button onclick="setLocalTestMode()">Enable Local Test Mode</button>
        <button onclick="clearLocalTestMode()">Clear Local Test Mode</button>
        <pre id="fix-result"></pre>
    </div>

    <div class="section">
        <h2>Step 3: Test Backend Connection</h2>
        <button onclick="testHealth()">Test Health Endpoint</button>
        <button onclick="testConfigure()">Test Configure Endpoint</button>
        <pre id="test-result"></pre>
    </div>

    <div class="section">
        <h2>Step 4: Monitor Real-time</h2>
        <button onclick="startMonitoring()">Start Monitoring</button>
        <button onclick="stopMonitoring()">Stop Monitoring</button>
        <pre id="monitor-result"></pre>
    </div>

    <script>
        let monitorInterval = null;

        function checkLocalStorage() {
            const result = {
                backendUrl: localStorage.getItem('backendUrl'),
                localTestMode: localStorage.getItem('localTestMode'),
                deploymentStatus: localStorage.getItem('deploymentStatus'),
                workflowRunId: localStorage.getItem('workflowRunId'),
                backendSubdomain: localStorage.getItem('backendSubdomain')
            };
            
            document.getElementById('localStorage-result').innerHTML = 
                JSON.stringify(result, null, 2);
            
            // Check if properly configured
            if (result.backendUrl === 'http://localhost:3000' && result.localTestMode === 'true') {
                document.getElementById('localStorage-result').innerHTML += 
                    '\n\n<span class="success">‚úÖ Local Test Mode is ENABLED</span>';
            } else {
                document.getElementById('localStorage-result').innerHTML += 
                    '\n\n<span class="error">‚ùå Local Test Mode is NOT properly configured</span>';
            }
        }

        function setLocalTestMode() {
            localStorage.setItem('backendUrl', 'http://localhost:3000');
            localStorage.setItem('localTestMode', 'true');
            localStorage.setItem('deploymentStatus', 'deployed');
            
            document.getElementById('fix-result').innerHTML = 
                '<span class="success">‚úÖ Local Test Mode ENABLED\n' +
                'backendUrl: http://localhost:3000\n' +
                'localTestMode: true\n' +
                'deploymentStatus: deployed\n\n' +
                'Now refresh your app page!</span>';
        }

        function clearLocalTestMode() {
            localStorage.removeItem('backendUrl');
            localStorage.removeItem('localTestMode');
            localStorage.removeItem('deploymentStatus');
            localStorage.removeItem('workflowRunId');
            localStorage.removeItem('backendSubdomain');
            
            document.getElementById('fix-result').innerHTML = 
                '<span class="warning">‚ö†Ô∏è Local Test Mode CLEARED\n' +
                'All backend settings removed.\n\n' +
                'Now refresh your app page!</span>';
        }

        async function testHealth() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = 'Testing health endpoint...';
            
            try {
                const response = await fetch('http://localhost:3000/api/health');
                const data = await response.json();
                resultDiv.innerHTML = 
                    '<span class="success">‚úÖ Health endpoint works!\n' +
                    JSON.stringify(data, null, 2) + '</span>';
            } catch (error) {
                resultDiv.innerHTML = 
                    '<span class="error">‚ùå Health endpoint failed!\n' +
                    error.message + '\n\n' +
                    'Make sure your backend is running on localhost:3000</span>';
            }
        }

        async function testConfigure() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = 'Testing configure endpoint...';
            
            const config = {
                kickmode: true,
                imprisonmode: false,
                modena: false,
                kickall: true,
                kickbybl: false,
                dadplus: false
            };
            
            try {
                const response = await fetch('http://localhost:3000/api/configure', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'bypass-tunnel-reminder': 'true'
                    },
                    body: JSON.stringify(config)
                });
                const data = await response.json();
                resultDiv.innerHTML = 
                    '<span class="success">‚úÖ Configure endpoint works!\n' +
                    'Request: ' + JSON.stringify(config, null, 2) + '\n\n' +
                    'Response: ' + JSON.stringify(data, null, 2) + '</span>';
            } catch (error) {
                resultDiv.innerHTML = 
                    '<span class="error">‚ùå Configure endpoint failed!\n' +
                    error.message + '\n\n' +
                    'Make sure your backend is running on localhost:3000</span>';
            }
        }

        function startMonitoring() {
            const resultDiv = document.getElementById('monitor-result');
            resultDiv.innerHTML = 'Monitoring started... Make changes in your UI now!\n\n';
            
            let logCount = 0;
            monitorInterval = setInterval(() => {
                const backendUrl = localStorage.getItem('backendUrl');
                const localTestMode = localStorage.getItem('localTestMode');
                const deploymentStatus = localStorage.getItem('deploymentStatus');
                
                logCount++;
                resultDiv.innerHTML = 
                    `[${new Date().toLocaleTimeString()}] Check #${logCount}\n` +
                    `backendUrl: ${backendUrl}\n` +
                    `localTestMode: ${localTestMode}\n` +
                    `deploymentStatus: ${deploymentStatus}\n\n` +
                    `Status: ${backendUrl === 'http://localhost:3000' ? '‚úÖ Ready' : '‚ùå Not configured'}\n\n` +
                    `Make changes in your UI and watch the Network tab in DevTools!`;
            }, 2000);
        }

        function stopMonitoring() {
            if (monitorInterval) {
                clearInterval(monitorInterval);
                monitorInterval = null;
                document.getElementById('monitor-result').innerHTML += '\n\nMonitoring stopped.';
            }
        }

        // Auto-check on load
        window.onload = () => {
            checkLocalStorage();
        };
    </script>
</body>
</html>
